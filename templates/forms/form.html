{% extends "base.html" %}
{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{url_for('displayFormsList')}}">Forms</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{profilename}}</li>
  </ol>
</nav>
<h3>{{profilename}}</h3>
<div class="form-container">
  <div class="row">
<div class="col-6" id="profile-form" aria-labelledby="profile-form">
    {% include 'forms/profileFieldForm.html' %}
</div>
<div class="col-6 form-preview-column">
  <div class="buttons">
      <button type="submit" class="btn btn-primary form-download-button" form="field-form"><i class="bi bi-download"></i> Download MODS</button>
</div>
  <div class="form-preview">
{% include 'preview.html' %}
</div>
</div>
</div>
</div>

<script>

  inputElements = document.getElementsByTagName("input")
  
  for (var inputElement of inputElements) {
    addEventListener('keyup', retrievePreview);
  }

  const previewParentDiv = document.getElementById("previewparent")
  previewParentDiv.style.display = "inherit"

  function retrievePreview() {

    const previewDiv = document.getElementById("preview")
    // previewDiv.innerText = ""

    const globalConditionCheckboxes = document.getElementsByClassName("form-check-input")
    var globalConditions = {}

    var formData = new FormData(document.querySelector('form'))

    fetch("/forms/profile/{{profilename}}/preview", { method: "POST", body: formData })
      .then(response => response.json())
      .then(function (data) {
        previewDiv.innerText = data.trim()
      }
      );

  }
</script>

{%endblock%}